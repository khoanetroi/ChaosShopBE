# ğŸ“Š Entity Relationship Diagram - Chaos Shop

## ğŸ—ºï¸ SÆ¡ Äá»“ Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CHAOS SHOP DATABASE                               â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ AUTHENTICATIONâ”‚  â”‚   PRODUCTS   â”‚  â”‚   ORDERS     â”‚  â”‚   SYSTEM    â”‚â”‚
â”‚  â”‚   & USERS     â”‚  â”‚  MANAGEMENT  â”‚  â”‚  MANAGEMENT  â”‚  â”‚   SUPPORT   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1ï¸âƒ£ Authentication & User Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   roles     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ role_id (PK)â”‚
â”‚ role_name   â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚ description â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                      â”‚ FK
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
â”‚        users             â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ user_id (PK)             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ email (UNIQUE)           â”‚          â”‚
â”‚ password_hash            â”‚          â”‚
â”‚ full_name                â”‚          â”‚ FK
â”‚ phone                    â”‚          â”‚
â”‚ role_id (FK)             â”‚          â”‚
â”‚ is_active                â”‚          â”‚
â”‚ is_verified              â”‚          â”‚
â”‚ last_login               â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                            â”‚
         â”‚ FK                         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                            â”‚
         â–¼                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  refresh_tokens     â”‚               â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
â”‚ token_id (PK)       â”‚               â”‚
â”‚ user_id (FK)        â”‚               â”‚
â”‚ token (UNIQUE)      â”‚               â”‚
â”‚ expires_at          â”‚               â”‚
â”‚ is_revoked          â”‚               â”‚
â”‚ ip_address          â”‚               â”‚
â”‚ user_agent          â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
         â”‚                            â”‚
         â”‚ FK                         â”‚
         â–¼                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚ verification_tokens â”‚               â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
â”‚ token_id (PK)       â”‚               â”‚
â”‚ user_id (FK)        â”‚               â”‚
â”‚ token (UNIQUE)      â”‚               â”‚
â”‚ token_type          â”‚               â”‚
â”‚ expires_at          â”‚               â”‚
â”‚ is_used             â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
         â”‚                            â”‚
         â”‚ FK                         â”‚
         â–¼                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   login_history     â”‚               â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
â”‚ history_id (PK)     â”‚               â”‚
â”‚ user_id (FK)        â”‚               â”‚
â”‚ login_time          â”‚               â”‚
â”‚ ip_address          â”‚               â”‚
â”‚ login_status        â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                                      â”‚
                                      â”‚
                                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ admin_activity_logs â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ log_id (PK)         â”‚
â”‚ user_id (FK)        â”‚
â”‚ action              â”‚
â”‚ table_name          â”‚
â”‚ record_id           â”‚
â”‚ ip_address          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2ï¸âƒ£ Product Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  categories  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ category_id  â”‚â—„â”€â”€â”€â”€â” Self-referencing
â”‚ category_nameâ”‚     â”‚ (parent-child)
â”‚ slug         â”‚     â”‚
â”‚ parent_id    â”‚â”€â”€â”€â”€â”€â”˜
â”‚ is_active    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ FK
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   brands     â”‚      â”‚  attributes  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ brand_id (PK)â”‚      â”‚ attribute_id â”‚
â”‚ brand_name   â”‚      â”‚ attribute_nameâ”‚
â”‚ slug         â”‚      â”‚ attribute_typeâ”‚
â”‚ is_active    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚ FK
       â”‚ FK                  â–¼
       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚ attribute_values â”‚
       â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚              â”‚ value_id (PK)    â”‚
       â”‚              â”‚ attribute_id (FK)â”‚
       â”‚              â”‚ value_name       â”‚
       â”‚              â”‚ color_code       â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚
       â”‚                     â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    products      â”‚         â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
â”‚ product_id (PK)  â”‚â—„â”€â”€â”€â”€â”   â”‚
â”‚ product_name     â”‚     â”‚   â”‚
â”‚ slug             â”‚     â”‚   â”‚
â”‚ sku              â”‚     â”‚   â”‚
â”‚ category_id (FK) â”‚     â”‚   â”‚
â”‚ brand_id (FK)    â”‚     â”‚   â”‚
â”‚ base_price       â”‚     â”‚   â”‚
â”‚ sale_price       â”‚     â”‚   â”‚
â”‚ is_active        â”‚     â”‚   â”‚
â”‚ is_featured      â”‚     â”‚   â”‚
â”‚ view_count       â”‚     â”‚   â”‚
â”‚ sold_count       â”‚     â”‚   â”‚
â”‚ rating_average   â”‚     â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
       â”‚                 â”‚   â”‚
       â”‚ FK              â”‚   â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
       â”‚                 â”‚   â”‚
       â–¼                 â”‚   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚ product_images   â”‚     â”‚   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚   â”‚
â”‚ image_id (PK)    â”‚     â”‚   â”‚
â”‚ product_id (FK)  â”‚     â”‚   â”‚
â”‚ image_url        â”‚     â”‚   â”‚
â”‚ is_primary       â”‚     â”‚   â”‚
â”‚ display_order    â”‚     â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
       â”‚                 â”‚   â”‚
       â”‚ FK              â”‚   â”‚
       â–¼                 â”‚   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚ product_variants â”‚     â”‚   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚   â”‚
â”‚ variant_id (PK)  â”‚â—„â”€â”€â”€â”€â”˜   â”‚
â”‚ product_id (FK)  â”‚         â”‚
â”‚ sku              â”‚         â”‚
â”‚ variant_name     â”‚         â”‚
â”‚ price_adjustment â”‚         â”‚
â”‚ stock_quantity   â”‚         â”‚
â”‚ is_active        â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
       â”‚                     â”‚
       â”‚ FK                  â”‚
       â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ variant_attributesâ”‚        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
â”‚ variant_attr_id  â”‚         â”‚
â”‚ variant_id (FK)  â”‚         â”‚
â”‚ attribute_id (FK)â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ value_id (FK)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3ï¸âƒ£ Customer & Shopping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ user_id (PK) â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
       â”‚                     â”‚
       â”‚ FK                  â”‚ FK
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                     â”‚                â”‚
       â–¼                     â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                â”‚
â”‚customer_addressesâ”‚         â”‚                â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚                â”‚
â”‚ address_id (PK)  â”‚         â”‚                â”‚
â”‚ user_id (FK)     â”‚         â”‚                â”‚
â”‚ recipient_name   â”‚         â”‚                â”‚
â”‚ phone            â”‚         â”‚                â”‚
â”‚ address_line     â”‚         â”‚                â”‚
â”‚ district         â”‚         â”‚                â”‚
â”‚ city             â”‚         â”‚                â”‚
â”‚ is_default       â”‚         â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                â”‚
       â”‚                     â”‚                â”‚
       â”‚ FK                  â”‚                â”‚
       â–¼                     â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    carts     â”‚      â”‚  wishlists   â”‚ â”‚notifications â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ cart_id (PK) â”‚      â”‚ wishlist_id  â”‚ â”‚notification_idâ”‚
â”‚ user_id (FK) â”‚      â”‚ user_id (FK) â”‚ â”‚ user_id (FK) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ product_id   â”‚ â”‚ title        â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ message      â”‚
       â”‚ FK                            â”‚ is_read      â”‚
       â–¼                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  cart_items  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ cart_item_id â”‚
â”‚ cart_id (FK) â”‚
â”‚ variant_id   â”‚â—„â”€â”€â”€â”€â”
â”‚ quantity     â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ FK (from product_variants)
                     â”‚
```

## 4ï¸âƒ£ Order Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ user_id (PK) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ FK
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       orders         â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ order_id (PK)        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ order_number (UNIQUE)â”‚         â”‚
â”‚ user_id (FK)         â”‚         â”‚
â”‚ recipient_name       â”‚         â”‚
â”‚ recipient_phone      â”‚         â”‚
â”‚ shipping_address     â”‚         â”‚
â”‚ district             â”‚         â”‚
â”‚ city                 â”‚         â”‚
â”‚ subtotal             â”‚         â”‚
â”‚ shipping_fee         â”‚         â”‚
â”‚ discount_amount      â”‚         â”‚
â”‚ total_amount         â”‚         â”‚
â”‚ order_status         â”‚         â”‚
â”‚ payment_status       â”‚         â”‚
â”‚ payment_method       â”‚         â”‚
â”‚ customer_note        â”‚         â”‚
â”‚ order_date           â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
       â”‚                         â”‚
       â”‚ FK                      â”‚ FK
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                         â”‚            â”‚
       â–¼                         â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚            â”‚
â”‚    order_items       â”‚         â”‚            â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚            â”‚
â”‚ order_item_id (PK)   â”‚         â”‚            â”‚
â”‚ order_id (FK)        â”‚         â”‚            â”‚
â”‚ product_id (FK)      â”‚         â”‚            â”‚
â”‚ variant_id (FK)      â”‚         â”‚            â”‚
â”‚ product_name         â”‚         â”‚            â”‚
â”‚ variant_name         â”‚         â”‚            â”‚
â”‚ quantity             â”‚         â”‚            â”‚
â”‚ unit_price           â”‚         â”‚            â”‚
â”‚ subtotal             â”‚         â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚            â”‚
       â”‚                         â”‚            â”‚
       â”‚ FK                      â”‚            â”‚
       â–¼                         â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚order_status_history  â”‚  â”‚ payment_transactions â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ history_id (PK)      â”‚  â”‚ transaction_id (PK)  â”‚
â”‚ order_id (FK)        â”‚  â”‚ order_id (FK)        â”‚
â”‚ old_status           â”‚  â”‚ transaction_code     â”‚
â”‚ new_status           â”‚  â”‚ payment_method       â”‚
â”‚ note                 â”‚  â”‚ amount               â”‚
â”‚ changed_by (FK)      â”‚  â”‚ status               â”‚
â”‚ changed_at           â”‚  â”‚ transaction_date     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5ï¸âƒ£ Promotions & Reviews

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     coupons      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ coupon_id (PK)   â”‚
â”‚ coupon_code      â”‚
â”‚ coupon_name      â”‚
â”‚ discount_type    â”‚
â”‚ discount_value   â”‚
â”‚ min_order_amount â”‚
â”‚ usage_limit      â”‚
â”‚ used_count       â”‚
â”‚ start_date       â”‚
â”‚ end_date         â”‚
â”‚ is_active        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ product_reviews  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ review_id (PK)   â”‚
â”‚ product_id (FK)  â”‚â—„â”€â”€â”€ FK to products
â”‚ user_id (FK)     â”‚â—„â”€â”€â”€ FK to users
â”‚ order_id (FK)    â”‚â—„â”€â”€â”€ FK to orders
â”‚ rating           â”‚
â”‚ comment          â”‚
â”‚ is_approved      â”‚
â”‚ created_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— Quan Há»‡ ChÃ­nh

### One-to-Many (1:N)
- 1 role â†’ N users
- 1 user â†’ N refresh_tokens
- 1 user â†’ N addresses
- 1 user â†’ N orders
- 1 category â†’ N products
- 1 brand â†’ N products
- 1 product â†’ N variants
- 1 product â†’ N images
- 1 order â†’ N order_items

### Many-to-Many (M:N)
- products â†” attributes (thÃ´ng qua variant_attributes)
- users â†” products (thÃ´ng qua wishlists)
- users â†” products (thÃ´ng qua carts & cart_items)

### Self-Referencing
- categories â†’ categories (parent_id)

## ğŸ“ˆ Luá»“ng Dá»¯ Liá»‡u ChÃ­nh

### 1. ÄÄƒng KÃ½ & ÄÄƒng Nháº­p
```
User Register â†’ users (is_verified=false)
              â†’ verification_tokens (email_verification)
              â†’ Send Email
              â†’ User Click Link
              â†’ Verify Token
              â†’ Update users (is_verified=true)

User Login â†’ Validate credentials
           â†’ Create refresh_token
           â†’ Return JWT + refresh_token
           â†’ Log to login_history
```

### 2. Mua HÃ ng
```
Browse Products â†’ products + product_variants
                â†’ Add to cart (cart_items)
                â†’ Select address (customer_addresses)
                â†’ Apply coupon (coupons)
                â†’ Create order (orders + order_items)
                â†’ Process payment (payment_transactions)
                â†’ Update stock (product_variants.stock_quantity)
                â†’ Send notification (notifications)
```

### 3. Quáº£n LÃ½ ÄÆ¡n HÃ ng
```
Order Created (pending)
  â†“
Admin Confirm (confirmed) â†’ order_status_history
  â†“
Processing (processing) â†’ order_status_history
  â†“
Shipping (shipping) â†’ order_status_history
  â†“
Delivered (delivered) â†’ order_status_history
  â†“
Customer Review â†’ product_reviews
```

## ğŸ¯ Index Strategy

### High-Priority Indexes (ÄÃ£ cÃ³)
- users.email (UNIQUE)
- products.slug (UNIQUE)
- orders.order_number (UNIQUE)
- refresh_tokens.token (UNIQUE)
- All Foreign Keys

### Composite Indexes (ÄÃ£ cÃ³)
- (user_id, is_default) on customer_addresses
- (cart_id, variant_id) on cart_items
- (user_id, product_id) on wishlists

### Performance Indexes (ÄÃ£ cÃ³)
- order_date on orders
- created_at on notifications
- login_time on login_history

## ğŸ”’ RÃ ng Buá»™c Dá»¯ Liá»‡u

### CHECK Constraints
- `rating BETWEEN 1 AND 5` on product_reviews

### UNIQUE Constraints
- email on users
- coupon_code on coupons
- order_number on orders
- token on refresh_tokens

### Foreign Key Constraints
- ON DELETE CASCADE: XÃ³a cha â†’ xÃ³a con
  - user â†’ refresh_tokens
  - product â†’ product_images
  - order â†’ order_items
  
- ON DELETE RESTRICT: KhÃ´ng cho xÃ³a náº¿u cÃ²n tham chiáº¿u
  - role â†’ users
  - category â†’ products
  - product â†’ order_items

- ON DELETE SET NULL: XÃ³a cha â†’ set NULL
  - brand â†’ products
  - user â†’ orders.processed_by

---

**LÆ°u Ã½:** SÆ¡ Ä‘á»“ nÃ y thá»ƒ hiá»‡n cáº¥u trÃºc logic. Äá»ƒ xem chi tiáº¿t implementation, tham kháº£o file `schema.sql`.
